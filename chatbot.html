<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>„Ç∑„É≥„Éó„É´HTML„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --panel: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #3b82f6;
      --user: #10b981;
      --bot: #3b82f6;
      --border: #e5e7eb;
    }
    .dark {
      --bg: #0b1220;
      --panel: #0f172a;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #60a5fa;
      --user: #34d399;
      --bot: #93c5fd;
      --border: #1f2937;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: grid;
      place-items: center;
      min-height: 100vh;
      padding: 16px;
    }
    .app {
      width: 100%;
      max-width: 800px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.06);
      display: grid;
      grid-template-rows: auto 1fr auto;
      overflow: hidden;
    }
    header {
      display: flex; align-items: center; gap: 12px; padding: 12px 16px;
      border-bottom: 1px solid var(--border);
    }
    header h1 { font-size: 16px; margin: 0; }
    header .spacer { flex: 1; }
    header button {
      border: 1px solid var(--border); background: transparent; color: var(--text);
      padding: 6px 10px; border-radius: 999px; cursor: pointer; font-size: 12px;
    }
    #chat {
      padding: 16px; overflow-y: auto; scroll-behavior: smooth;
      background: linear-gradient(180deg, var(--panel), var(--panel) 60%, transparent),
                  radial-gradient(1200px 200px at 50% -50%, rgba(59,130,246,0.06), transparent 60%);
    }
    .msg { display: flex; gap: 10px; margin: 8px 0; align-items: flex-start; }
    .bubble {
      max-width: 75%; padding: 10px 12px; border-radius: 14px; line-height: 1.5; border: 1px solid var(--border);
      background: #fff0; color: var(--text);
    }
    .bot .bubble { background: rgba(59,130,246,0.08); border-color: rgba(59,130,246,0.25); }
    .user .bubble { background: rgba(16,185,129,0.10); border-color: rgba(16,185,129,0.25); margin-left: auto; }
    .role { font-size: 11px; color: var(--muted); margin-top: 2px; }

    .quick {
      display: flex; flex-wrap: wrap; gap: 8px; margin: 8px 0 0 38px;
    }
    .chip {
      border: 1px solid var(--border); background: transparent; color: var(--text);
      padding: 6px 10px; border-radius: 999px; cursor: pointer; font-size: 12px;
    }

    form {
      display: grid; grid-template-columns: 1fr auto; gap: 8px;
      padding: 12px; border-top: 1px solid var(--border); background: var(--panel);
    }
    input[type="text"] {
      width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid var(--border); background: transparent; color: var(--text);
    }
    button.send {
      padding: 12px 16px; border: none; border-radius: 12px; cursor: pointer; color: white;
      background: var(--accent);
    }
    .tools { display: flex; gap: 8px; }
    .tools button { border: 1px solid var(--border); background: transparent; color: var(--text); padding: 6px 10px; border-radius: 10px; cursor: pointer; font-size: 12px; }

    .sr-only { position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden; }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>„É≠„Éº„Ç´„É´„Éª„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà</h1>
      <div class="spacer"></div>
      <div class="tools">
        <button id="btn-clear" title="Â±•Ê≠¥„ÇíÊ∂àÂéª">„ÇØ„É™„Ç¢</button>
        <button id="btn-export" title="„ÉÜ„Ç≠„Çπ„Éà„Å®„Åó„Å¶‰øùÂ≠ò">„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
        <button id="btn-theme" title="„ÉÜ„Éº„ÉûÂàáÊõø">üåó „ÉÜ„Éº„Éû</button>
      </div>
    </header>

    <main id="chat" aria-live="polite" aria-label="‰ºöË©±„É≠„Ç∞"></main>

    <form id="composer" autocomplete="off">
      <label class="sr-only" for="input">„É°„ÉÉ„Çª„Éº„Ç∏</label>
      <input id="input" type="text" placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•ÂäõÔºà‰æã: „Éò„É´„Éó, Âñ∂Ê•≠ÊôÇÈñì, „Ç∏„Éß„Éº„ÇØÔºâ" />
      <button class="send" type="submit">ÈÄÅ‰ø°</button>
    </form>
  </div>

  <script>
    // ====== Á∞°ÊòìNLUÔºà„Ç≠„Éº„ÉØ„Éº„Éâ‰∏ÄËá¥Ôºâ ======
    const rules = [
      { intent: 'greet', patterns: ['„Åì„Çì„Å´„Å°„ÅØ','„Åì„Çì','„ÇÑ„ÅÇ','hello','hi'], reply: () => `„Åì„Çì„Å´„Å°„ÅØÔºÅ‰ªäÊó•„ÅØ‰Ωï„Çí„Åó„Åæ„Åô„ÅãÔºü` },
      { intent: 'help',  patterns: ['„Éò„É´„Éó','‰Ωø„ÅÑÊñπ','help','„Å§„Åã„ÅÑ„Åã„Åü'], reply: helpText },
      { intent: 'hours', patterns: ['Âñ∂Ê•≠ÊôÇÈñì','ÊôÇÈñì','„ÅÇ„ÅÑ„Å¶„Çã'], reply: () => 'Âñ∂Ê•≠ÊôÇÈñì„ÅØ Âπ≥Êó• 10:00-18:00 „Åß„Åô„ÄÇÂúüÊó•Á•ù„ÅØ„Åä‰ºë„Åø„Åß„Åô„ÄÇ'},
      { intent: 'contact', patterns: ['Âïè„ÅÑÂêà„Çè„Åõ','ÈÄ£Áµ°','„É°„Éº„É´','contact'], reply: () => '„ÅäÂïè„ÅÑÂêà„Çè„Åõ„ÅØ example@example.com „Åæ„Åß„ÅäÈ°ò„ÅÑ„Åó„Åæ„ÅôÔºà„ÉÄ„Éü„ÉºÔºâ„ÄÇ'},
      { intent: 'joke', patterns: ['„Ç∏„Éß„Éº„ÇØ','ÂÜóË´á','Á¨ë','joke'], reply: dadJoke },
      { intent: 'menu', patterns: ['„É°„Éã„É•„Éº','‰Ωï„Åå„Åß„Åç„Çã','„Åß„Åç„Çã„Åì„Å®','menu'], reply: menuText },
      { intent: 'bye', patterns: ['„Å∞„ÅÑ','„Åï„Çà„ÅÜ„Å™„Çâ','„Åæ„Åü„Å≠','bye'], reply: () => '„ÅäË©±„Åó„Åß„Åç„Å¶Ê•Ω„Åó„Åã„Å£„Åü„Åß„Åô„ÄÇ„Åæ„Åü„Å©„ÅÜ„ÅûÔºÅ' },
    ];

    function helpText(){
      return `‰Ωø„ÅÑÊñπÔºö„ÉÜ„Ç≠„Çπ„Éà„ÅßË≥™Âïè„Åô„Çã„Åã„ÄÅ‰∏ã„Å´Âá∫„Çã„Éú„Çø„É≥Ôºà„ÇØ„Ç§„ÉÉ„ÇØËøî‰ø°Ôºâ„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n‰æã: „ÄåÂñ∂Ê•≠ÊôÇÈñì„Äç„Äå„Ç∏„Éß„Éº„ÇØ„Äç„ÄåÂïè„ÅÑÂêà„Çè„Åõ„Äç`;
    }
    function menuText(){
      return `„Åß„Åç„Çã„Åì„Å®Ôºö\n- Á∞°Âçò„Å™Ë≥™Âïè„ÅÆÂõûÁ≠îÔºàÂñ∂Ê•≠ÊôÇÈñì/Âïè„ÅÑÂêà„Çè„Åõ „Å™„Å©Ôºâ\n- „É©„É≥„ÉÄ„É†„Å™„Ç∏„Éß„Éº„ÇØ„ÇíË®Ä„ÅÜ\n- ÈÅ∏ÊäûËÇ¢„Éô„Éº„Çπ„ÅÆÊ°àÂÜÖ\n‚Äª „Åì„ÅÆ„Éú„ÉÉ„Éà„ÅØÂÆåÂÖ®„Å´„É≠„Éº„Ç´„É´„ÅßÂãï‰Ωú„Åó„ÄÅ„Çµ„Éº„Éê‰∏çË¶Å„Åß„Åô„ÄÇ`;
    }
    function dadJoke(){
      const jokes = [
        '„Éó„É≠„Ç∞„É©„Éû„Éº„Åå„Éè„É≠„Ç¶„Ç£„É≥„ÇíÈñìÈÅï„Åà„ÇãÁêÜÁî±Ôºü 10/31 „Å® 31/10 „ÇíÂêå„Åò„Å®ÊÄù„ÅÜ„Åã„Çâ„ÄÇ',
        'Èñ¢Êï∞„ÅåÂà•„Çå„ÅüÔºü Áõ∏ÊÄßÔºàÂèÇÁÖßÊ∏°„ÅóÔºâ„ÅåÊÇ™„Åã„Å£„Åü„Åø„Åü„ÅÑ„ÄÇ',
        'Wi-Fi „Å´ÂÜóË´áË®Ä„Å£„Åü„ÇâÔºü ÂèçÂøúÔºàÂøúÁ≠îÔºâ„ÅåÂº±„Åã„Å£„Åü„ÄÇ'
      ];
      return jokes[Math.floor(Math.random()*jokes.length)];
    }

    // ====== DOM„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ ======
    const $chat = document.getElementById('chat');
    const $input = document.getElementById('input');

    function addMessage(role, text, quick = []){
      const wrap = document.createElement('div');
      wrap.className = `msg ${role}`;

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;

      const meta = document.createElement('div');
      meta.className = 'role';
      meta.textContent = role === 'user' ? 'You' : 'Bot';

      wrap.appendChild(bubble);
      wrap.appendChild(meta);
      $chat.appendChild(wrap);

      if(quick && quick.length){
        const qWrap = document.createElement('div');
        qWrap.className = 'quick';
        quick.forEach(q => {
          const btn = document.createElement('button');
          btn.className = 'chip';
          btn.type = 'button';
          btn.textContent = q.label;
          btn.addEventListener('click', () => handleUserText(q.text));
          qWrap.appendChild(btn);
        });
        $chat.appendChild(qWrap);
      }

      // ‰øùÂ≠ò & „Çπ„ÇØ„É≠„Éº„É´
      persist();
      $chat.scrollTop = $chat.scrollHeight;
    }

    function botReply(text, quick){ addMessage('bot', text, quick); }
    function userSay(text){ addMessage('user', text); }

    function matchIntent(text){
      const t = text.toLowerCase();
      for(const r of rules){
        if(r.patterns.some(p => t.includes(p.toLowerCase()))) return r;
      }
      return null;
    }

    function handleUserText(text){
      if(!text) return;
      userSay(text);

      const intent = matchIntent(text);
      if(intent){
        const replyText = typeof intent.reply === 'function' ? intent.reply(text) : intent.reply;
        const quick = [
          {label:'„É°„Éã„É•„Éº', text:'„É°„Éã„É•„Éº'},
          {label:'„Éò„É´„Éó', text:'„Éò„É´„Éó'},
          {label:'„Ç∏„Éß„Éº„ÇØ', text:'„Ç∏„Éß„Éº„ÇØ'}
        ];
        setTimeout(() => botReply(replyText, quick), 250);
        return;
      }

      // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂøúÁ≠îÔºàË∂ÖÁ∞°ÊòìÔºâ
      const fallback = `„Äå${text}„Äç„Åß„Åô„Å≠„ÄÇË©≥„Åó„Åè„ÅØ„Äå„É°„Éã„É•„Éº„Äç„Åæ„Åü„ÅØ„Äå„Éò„É´„Éó„Äç„Å®ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
      const quick = [
        {label:'Âñ∂Ê•≠ÊôÇÈñì', text:'Âñ∂Ê•≠ÊôÇÈñì'},
        {label:'Âïè„ÅÑÂêà„Çè„Åõ', text:'Âïè„ÅÑÂêà„Çè„Åõ'},
        {label:'„Ç∏„Éß„Éº„ÇØ', text:'„Ç∏„Éß„Éº„ÇØ'}
      ];
      setTimeout(() => botReply(fallback, quick), 250);
    }

    // ====== „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÅßÂ±•Ê≠¥‰øùÊåÅ ======
    function persist(){ localStorage.setItem('chatlog', $chat.innerHTML); }
    function restore(){
      const saved = localStorage.getItem('chatlog');
      if(saved){ $chat.innerHTML = saved; attachQuickHandlers(); }
      else { welcome(); }
      $chat.scrollTop = $chat.scrollHeight;
    }

    function attachQuickHandlers(){
      document.querySelectorAll('.chip').forEach(btn => {
        if(!btn.dataset.bound){
          btn.addEventListener('click', () => handleUserText(btn.textContent));
          btn.dataset.bound = '1';
        }
      });
    }

    function welcome(){
      botReply('„Çà„ÅÜ„Åì„ÅùÔºÅ„É≠„Éº„Ç´„É´„ÅßÂãï„Åè„Ç∑„É≥„Éó„É´„Å™„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà„Åß„Åô„ÄÇ', [
        {label:'„É°„Éã„É•„Éº', text:'„É°„Éã„É•„Éº'},
        {label:'„Éò„É´„Éó', text:'„Éò„É´„Éó'},
        {label:'„Ç∏„Éß„Éº„ÇØ', text:'„Ç∏„Éß„Éº„ÇØ'}
      ]);
    }

    // ====== „Ç§„Éô„É≥„Éà ======
    document.getElementById('composer').addEventListener('submit', (e) => {
      e.preventDefault();
      const text = $input.value.trim();
      if(!text) return;
      $input.value = '';
      handleUserText(text);
    });

    document.getElementById('btn-clear').addEventListener('click', () => {
      if(confirm('Â±•Ê≠¥„ÇíÊ∂àÂéª„Åó„Åæ„Åô„ÅãÔºü')){
        localStorage.removeItem('chatlog');
        $chat.innerHTML = '';
        welcome();
      }
    });

    document.getElementById('btn-theme').addEventListener('click', () => {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    });

    document.getElementById('btn-export').addEventListener('click', () => {
      const text = $chat.innerText.replace(/\n\n/g, '\n');
      const blob = new Blob([text], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `chatlog_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    });

    // Âæ©ÂÖÉ & „ÉÜ„Éº„ÉûÂæ©ÂÖÉ
    (function init(){
      if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');
      restore();
    })();
  </script>
</body>
</html>
